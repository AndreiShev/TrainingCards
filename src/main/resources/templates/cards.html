<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
        xmlns:th="http://www.thymeleaf.org" lang="ru">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>CardMaster - –û–±—É—á–µ–Ω–∏–µ</title>
        <link rel="stylesheet" type="text/css" media="all" th:href="@{/css/common.css}">
    </head>
    <body>
        <!-- Header -->
        <header class="header-cards">
            <div class="container">
                <nav class="nav">
                    <a href="#" class="logo">CardMaster</a>
                    <div class="user-menu">
                        <span>–ü—Ä–∏–≤–µ—Ç, –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å!</span>
                        <button class="btn btn-outline" onclick="goHome()">–ù–∞ –≥–ª–∞–≤–Ω—É—é</button>
                    </div>
                </nav>
            </div>
        </header>

        <!-- Main Content -->
        <!-- Main Content -->
        <div class="container">
            <div class="main-layout">
                <!-- Sidebar with Categories -->
                <div class="sidebar">
                    <h3>–ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –∫–∞—Ä—Ç–æ—á–µ–∫</h3>
                    <ul class="categories-list" id="categoriesList">
                        <!-- Categories will be populated by JavaScript -->
                    </ul>
                    <button class="btn btn-outline" style="width: 100%; margin-top: 1rem;" >
                        + –ù–æ–≤–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è
                    </button>
                    <form name="addCategoryForm">
                        <input type="text" name="name" placeholder="–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏">
                        <input type="text" name="description" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ">
                        <input type="submit" value="—Å–æ–∑–¥–∞—Ç—å" id="addCategoryButton">
                    </form>
                </div>

                <!-- Content Area -->
                <div class="content">
                    <!-- Cards List View -->
                    <div id="cardsListView">
                        <div class="cards-header">
                            <h2 id="currentCategory">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é</h2>
                            <button class="btn btn-primary" id="startLearningBtn" style="display: none;" onclick="startLearning()">
                                üéØ –ù–∞—á–∞—Ç—å –æ–±—É—á–µ–Ω–∏–µ
                            </button>
                        </div>
                        <div id="cardsContainer">
                            <div class="empty-state">
                                <div>üìö</div>
                                <h3>–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∫–∞—Ä—Ç–æ—á–µ–∫</h3>
                                <p>–ö–∞—Ä—Ç–æ—á–∫–∏ –ø–æ—è–≤—è—Ç—Å—è –∑–¥–µ—Å—å –ø–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</p>
                            </div>
                        </div>
                    </div>

                    <!-- Learning View -->
                    <div id="learningView" class="learning-view">
                        <div class="progress-info">
                            –ö–∞—Ä—Ç–æ—á–∫–∞ <span id="currentCardNumber">1</span> –∏–∑ <span id="totalCards">0</span>
                        </div>

                        <div class="card-container" id="cardContainer" onclick="flipCard()">
                            <div class="card-content">
                                <div class="card-question-content" id="cardQuestion">
                                    –í–æ–ø—Ä–æ—Å –ø–æ—è–≤–∏—Ç—Å—è –∑–¥–µ—Å—å
                                </div>
                                <div class="card-answer-content" id="cardAnswer">
                                    –û—Ç–≤–µ—Ç –ø–æ—è–≤–∏—Ç—Å—è –∑–¥–µ—Å—å –ø–æ—Å–ª–µ –Ω–∞–∂–∞—Ç–∏—è –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫—É
                                </div>
                            </div>
                        </div>

                        <div class="navigation">
                            <button class="btn btn-secondary" onclick="prevCard()">
                                ‚¨ÖÔ∏è –ù–∞–∑–∞–¥
                            </button>
                            <button class="btn btn-outline" onclick="editCurrentCard()">
                                ‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
                            </button>
                            <button class="btn btn-primary" onclick="nextCard()">
                                –î–∞–ª–µ–µ ‚û°Ô∏è
                            </button>
                        </div>

                        <div style="text-align: center; margin-top: 2rem;">
                            <button class="btn btn-secondary" onclick="backToCards()">
                                ‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ —Å–ø–∏—Å–∫—É
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <script>
            let xhr = new XMLHttpRequest();
            xhr.open('GET', '/api/v1/cards/');
            xhr.responseType = 'json';
            xhr.send();
            const categories = [];
            const cards = {};

            xhr.onload = function() {
                let categoriesArr = xhr.response["cardCategories"];

                for (let i = 0; i < categoriesArr.length; i++) {
                    categories.push({"id": categoriesArr[i].id, "name": categoriesArr[i].name, "cardCount": categoriesArr[i].cardCount});
                    cards[categoriesArr[i].id] = categoriesArr[i].cards;
                }

                initCategories();
            };

            let currentCategoryId = null;
            let currentCards = [];
            let currentCardIndex = 0;
            let isLearning = false;

            // Initialize categories
            function initCategories() {
                const categoriesList = document.getElementById('categoriesList');
                categoriesList.innerHTML = '';
                const addCategoryButton = document.getElementById('addCategoryButton');
                addCategoryButton.addEventListener('click', addCard);

                categories.forEach(category => {
                    const li = document.createElement('li');
                    li.className = 'category-item';
                    li.innerHTML = `
                                        <span>${category.name}</span>
                                        <span class="card-count">${category.cardCount}</span>
                                    `;
                    li.onclick = () => selectCategory(category.id);
                    categoriesList.appendChild(li);
                });
            }

            // Select category
            function selectCategory(categoryId) {
                currentCategoryId = categoryId;

                // Update active category
                document.querySelectorAll('.category-item').forEach(item => {
                    item.classList.remove('active');
                });
                event.currentTarget.classList.add('active');

                // Show category name
                const category = categories.find(c => c.id === categoryId);
                document.getElementById('currentCategory').textContent = category.name;

                // Show cards
                showCards(categoryId);

                // Show start learning button
                document.getElementById('startLearningBtn').style.display = 'inline-flex';
            }

            function addCard(e) {
                // –∑–∞–ø–æ–ª–Ω–∏–º FormData –¥–∞–Ω–Ω—ã–º–∏ –∏–∑ —Ñ–æ—Ä–º—ã
                let formData = new FormData(document.forms.addCategoryForm);
                let json = JSON.stringify({
                    name: formData.get('name'),
                    description: formData.get('description')
                });
                // –æ—Ç–ø—Ä–∞–≤–∏–º –¥–∞–Ω–Ω—ã–µ
                let xhr = new XMLHttpRequest();
                xhr.open("POST", "/api/v1/cards/addCategory");
                xhr.setRequestHeader('Content-type', 'application/json; charset=utf-8');
                xhr.send(json);

                xhr.onload = function() {
                    let newCategory = JSON.parse(xhr.response);
                    const categoriesList = document.getElementById('categoriesList');
                    const li = document.createElement('li');
                    li.className = 'category-item';
                    li.innerHTML = `
                                        <span>${newCategory.name}</span>
                                        <span class="card-count">${newCategory.cardCount}</span>
                                    `;
                    li.onclick = () => selectCategory(newCategory.id);
                    categoriesList.appendChild(li);
                }
            }

            // Show cards for category
            function showCards(categoryId) {
                const cardsContainer = document.getElementById('cardsContainer');
                const categoryCards = cards[categoryId] || [];
                currentCards = categoryCards;

                if (categoryCards.length === 0) {
                    cardsContainer.innerHTML = `
                    <div class="empty-state">
                        <div>üìù</div>
                        <h3>–í —ç—Ç–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø–æ–∫–∞ –Ω–µ—Ç –∫–∞—Ä—Ç–æ—á–µ–∫</h3>
                        <p>–°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤—É—é –∫–∞—Ä—Ç–æ—á–∫—É –¥–ª—è –Ω–∞—á–∞–ª–∞ –æ–±—É—á–µ–Ω–∏—è</p>
                        <button class="btn btn-primary" style="margin-top: 1rem;">+ –î–æ–±–∞–≤–∏—Ç—å –∫–∞—Ä—Ç–æ—á–∫—É</button>
                    </div>
                `;
                    return;
                }

                cardsContainer.innerHTML = `
                <div class="cards-grid">
                    ${categoryCards.map(card => `
                        <div class="card-item" onclick="editCard(${card.id})">
                            <div class="card-question">${card.question}</div>
                            <div class="card-answer">${card.answer}</div>
                        </div>
                    `).join('')}
                </div>
            `;
            }

            // Start learning
            function startLearning() {
                if (currentCards.length === 0) {
                    alert('–í —ç—Ç–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –Ω–µ—Ç –∫–∞—Ä—Ç–æ—á–µ–∫ –¥–ª—è –æ–±—É—á–µ–Ω–∏—è!');
                    return;
                }

                isLearning = true;
                currentCardIndex = 0;

                // Switch to learning view
                document.getElementById('cardsListView').style.display = 'none';
                document.getElementById('learningView').style.display = 'block';

                showCurrentCard();
            }

            // Show current card
            function showCurrentCard() {
                const card = currentCards[currentCardIndex];
                document.getElementById('cardQuestion').textContent = card.question;
                document.getElementById('cardAnswer').textContent = card.answer;
                document.getElementById('currentCardNumber').textContent = currentCardIndex + 1;
                document.getElementById('totalCards').textContent = currentCards.length;

                // Reset card flip state
                document.getElementById('cardContainer').classList.remove('card-flipped');
            }

            // Flip card
            function flipCard() {
                document.getElementById('cardContainer').classList.toggle('card-flipped');
            }

            // Next card
            function nextCard() {
                if (currentCardIndex < currentCards.length - 1) {
                    currentCardIndex++;
                    showCurrentCard();
                } else {
                    alert('üéâ –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –í—ã –∑–∞–≤–µ—Ä—à–∏–ª–∏ –∏–∑—É—á–µ–Ω–∏–µ —ç—Ç–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏!');
                    backToCards();
                }
            }

            // Previous card
            function prevCard() {
                if (currentCardIndex > 0) {
                    currentCardIndex--;
                    showCurrentCard();
                }
            }

            // Edit current card
            function editCurrentCard() {
                const card = currentCards[currentCardIndex];
                editCard(card.id);
            }

            // Edit card (placeholder)
            function editCard(cardId) {
                alert(`–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞—Ä—Ç–æ—á–∫–∏ #${cardId}\n\n–í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—É–¥–µ—Ç –æ—Ç–∫—Ä—ã–≤–∞—Ç—å—Å—è —Ñ–æ—Ä–º–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è`);
            }

            // Back to cards list
            function backToCards() {
                isLearning = false;
                document.getElementById('learningView').style.display = 'none';
                document.getElementById('cardsListView').style.display = 'block';
            }

            // Go home
            function goHome() {
                window.location.href = 'index.html'; // –ü—Ä–µ–¥–ø–æ–ª–∞–≥–∞—è, —á—Ç–æ –≥–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è index.html
            }
        </script>
    </body>
</html>